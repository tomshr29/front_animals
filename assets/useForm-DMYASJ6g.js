import{b as k,S as Mt,D as Y,r as j,j as N,a as ft}from"./index-DgK2n8Ij.js";const w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));function gt(e,s=0){return(w[e[s+0]]+w[e[s+1]]+w[e[s+2]]+w[e[s+3]]+"-"+w[e[s+4]]+w[e[s+5]]+"-"+w[e[s+6]]+w[e[s+7]]+"-"+w[e[s+8]]+w[e[s+9]]+"-"+w[e[s+10]]+w[e[s+11]]+w[e[s+12]]+w[e[s+13]]+w[e[s+14]]+w[e[s+15]]).toLowerCase()}let Q;const yt=new Uint8Array(16);function bt(){if(!Q){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Q=crypto.getRandomValues.bind(crypto)}return Q(yt)}const St=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lt={randomUUID:St};function Vt(e,s,n){var i;e=e||{};const t=e.random??((i=e.rng)==null?void 0:i.call(e))??bt();if(t.length<16)throw new Error("Random bytes length must be >= 16");return t[6]=t[6]&15|64,t[8]=t[8]&63|128,gt(t)}function Ft(e,s,n){return lt.randomUUID&&!e?lt.randomUUID():Vt(e)}function G(e,s){return typeof e=="function"?e(s):e}function R(e,s){return st(s).reduce((t,i)=>{if(t===null)return null;if(typeof t<"u")return t[i]},e)}function U(e,s,n){const t=st(s);function i(r){if(!t.length)return G(n,r);const a=t.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(r))return typeof r=="object"?(r===null&&(r={}),{...r,[a]:i(r[a])}):{[a]:i()};if(Array.isArray(r)&&typeof a=="number"){const l=r.slice(0,a);return[...l.length?l:new Array(a),i(r[a]),...r.slice(a+1)]}return[...new Array(a),i()]}return i(e)}function At(e,s){const n=st(s);function t(i){if(!i)return;if(n.length===1){const a=n[0];if(Array.isArray(i)&&typeof a=="number")return i.filter((d,h)=>h!==a);const{[a]:l,...u}=i;return u}const r=n.shift();if(typeof r=="string"&&typeof i=="object")return{...i,[r]:t(i[r])};if(typeof r=="number"&&Array.isArray(i)){if(r>=i.length)return i;const a=i.slice(0,r);return[...a.length?a:new Array(r),t(i[r]),...i.slice(r+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(e)}const wt=/^(\d+)$/gm,pt=/\.(\d+)(?=\.)/gm,Et=/^(\d+)\./gm,It=/\.(\d+$)/gm,Lt=/\.{2,}/gm,Z="__int__",W=`${Z}$1`;function st(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(wt,W).replace(pt,`.${W}.`).replace(Et,`${W}.`).replace(It,`.${W}`).replace(Lt,".").split(".").map(s=>{if(s.startsWith(Z)){const n=s.substring(Z.length),t=parseInt(n,10);return String(t)===n?t:n}return s})}function Ot(e){return!(Array.isArray(e)&&e.length===0)}function tt(e,s){const n=t=>t.validators.filter(Boolean).map(i=>({cause:i.cause,validate:i.fn}));return s.validationLogic({form:s.form,validators:s.validators,event:{type:e,async:!1},runValidation:n})}function et(e,s){const{asyncDebounceMs:n}=s,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:i,onDynamicAsyncDebounceMs:r}=s.validators||{},a=n??0,l=u=>u.validators.filter(Boolean).map(d=>{const h=(d==null?void 0:d.cause)||e;let c=a;switch(h){case"change":c=i??a;break;case"blur":c=t??a;break;case"dynamic":c=r??a;break;case"submit":c=0;break}return e==="submit"&&(c=0),{cause:h,validate:d.fn,debounceMs:c}});return s.validationLogic({form:s.form,validators:s.validators,event:{type:e,async:!0},runValidation:l})}const it=e=>!!e&&typeof e=="object"&&"fields"in e;function C(e,s){if(Object.is(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;if(e instanceof Date&&s instanceof Date)return e.getTime()===s.getTime();if(e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(const[i,r]of e)if(!s.has(i)||!Object.is(r,s.get(i)))return!1;return!0}if(e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(const i of e)if(!s.has(i))return!1;return!0}const n=Object.keys(e),t=Object.keys(s);if(n.length!==t.length)return!1;for(const i of n)if(!t.includes(i)||!C(e[i],s[i]))return!1;return!0}const ut=({newFormValidatorError:e,isPreviousErrorFromFormValidator:s,previousErrorValue:n})=>e?{newErrorValue:e,newSource:"form"}:s?{newErrorValue:void 0,newSource:void 0}:n?{newErrorValue:n,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},dt=({formLevelError:e,fieldLevelError:s})=>s?{newErrorValue:s,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function I(e,s){return e==null?s:{...e,...s}}const _=e=>{if(!e.validators)return e.runValidation({validators:[],form:e.form});const s=e.event.async,n=s?void 0:{fn:e.validators.onMount,cause:"mount"},t={fn:s?e.validators.onChangeAsync:e.validators.onChange,cause:"change"},i={fn:s?e.validators.onBlurAsync:e.validators.onBlur,cause:"blur"},r={fn:s?e.validators.onSubmitAsync:e.validators.onSubmit,cause:"submit"},a=s?void 0:{fn:()=>{},cause:"server"};switch(e.event.type){case"mount":return e.runValidation({validators:[n],form:e.form});case"submit":return e.runValidation({validators:[t,i,r,a],form:e.form});case"server":return e.runValidation({validators:[],form:e.form});case"blur":return e.runValidation({validators:[i,a],form:e.form});case"change":return e.runValidation({validators:[t,a],form:e.form});default:throw new Error(`Unknown validation event type: ${e.event.type}`)}};function Dt(e){const s=new Map;for(const n of e){const t=[...n.path??[]].map(i=>{const r=typeof i=="object"?i.key:i;return typeof r=="number"?`[${r}]`:r}).join(".").replace(/\.\[/g,"[");s.set(t,(s.get(t)??[]).concat(n))}return Object.fromEntries(s)}const ct=e=>{const s=Dt(e);return{form:s,fields:s}},B={validate({value:e,validationSource:s},n){const t=n["~standard"].validate(e);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return s==="field"?t.issues:ct(t.issues)},async validateAsync({value:e,validationSource:s},n){const t=await n["~standard"].validate(e);if(t.issues)return s==="field"?t.issues:ct(t.issues)}},mt=e=>!!e&&"~standard"in e,q={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function K(e){function s(c,o,f,m){const M=t(c,o,f,m);({insert:()=>l(M,c,o),remove:()=>u(M),swap:()=>m!==void 0&&h(M,c,o,m),move:()=>m!==void 0&&d(M,c,o,m)})[f]()}function n(c,o){return`${c}[${o}]`}function t(c,o,f,m){const M=[n(c,o)];if(f==="swap")M.push(n(c,m));else if(f==="move"){const[v,g]=[Math.min(o,m),Math.max(o,m)];for(let y=v;y<=g;y++)M.push(n(c,y))}else{const v=e.getFieldValue(c),g=Array.isArray(v)?v.length:0;for(let y=o+1;y<g;y++)M.push(n(c,y))}return Object.keys(e.fieldInfo).filter(v=>M.some(g=>v.startsWith(g)))}function i(c,o){return c.replace(/\[(\d+)\]/,(f,m)=>{const M=parseInt(m,10);return`[${o==="up"?M+1:Math.max(0,M-1)}]`})}function r(c,o){(o==="up"?c:[...c].reverse()).forEach(m=>{const M=i(m.toString(),o),v=e.getFieldMeta(M);v?e.setFieldMeta(m,v):e.setFieldMeta(m,a())})}const a=()=>q,l=(c,o,f)=>{r(c,"down"),c.forEach(m=>{m.toString().startsWith(n(o,f))&&e.setFieldMeta(m,a())})},u=c=>{r(c,"up")},d=(c,o,f,m)=>{const M=new Map(Object.keys(e.fieldInfo).filter(v=>v.startsWith(n(o,f))).map(v=>[v,e.getFieldMeta(v)]));r(c,f<m?"up":"down"),Object.keys(e.fieldInfo).filter(v=>v.startsWith(n(o,m))).forEach(v=>{const g=v.replace(n(o,m),n(o,f)),y=M.get(g);y&&e.setFieldMeta(v,y)})},h=(c,o,f,m)=>{c.forEach(M=>{if(!M.toString().startsWith(n(o,f)))return;const v=M.toString().replace(n(o,f),n(o,m)),[g,y]=[e.getFieldMeta(M),e.getFieldMeta(v)];g&&e.setFieldMeta(v,g),y&&e.setFieldMeta(M,y)})};return{handleArrayFieldMetaShift:s}}class kt{on(s,n){}onAll(s){}onAllPluginEvents(s){}emit(s,...n){}getPluginId(){}}const Tt=kt;class Ct extends Tt{constructor(){super({pluginId:"form-devtools"})}}const O=new Ct;function X(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class _t{constructor(s){var n;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var l,u;const t=this.fieldMetaDerived.mount(),i=this.store.mount(),r=()=>{t(),i(),O.emit("form-unmounted",{id:this._formId})};(u=(l=this.options.listeners)==null?void 0:l.onMount)==null||u.call(l,{formApi:this});const{onMount:a}=this.options.validators||{};return O.emit("form-state-change",{id:this._formId,state:this.store.state,options:this.options}),a&&this.validateSync("mount"),r},this.update=t=>{var u,d;if(!t)return;const i=this.options;this.options=t;const r=!!((d=(u=t.transform)==null?void 0:u.deps)!=null&&d.some((h,c)=>h!==this.prevTransformArray[c])),a=t.defaultValues&&!C(t.defaultValues,i.defaultValues)&&!this.state.isTouched,l=!C(t.defaultState,i.defaultState)&&!this.state.isTouched;!a&&!l&&!r||k(()=>{this.baseStore.setState(()=>X(Object.assign({},this.state,l?t.defaultState:{},a?{values:t.defaultValues}:{},r?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(t,i)=>{const{fieldMeta:r}=this.state,a=this.resetFieldMeta(r);t&&!(i!=null&&i.keepDefaultValues)&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>{var l;return X({...this.options.defaultState,values:t??this.options.defaultValues??((l=this.options.defaultState)==null?void 0:l.values),fieldMetaBase:a})})},this.validateAllFields=async t=>{const i=[];return k(()=>{Object.values(this.fieldInfo).forEach(a=>{if(!a.instance)return;const l=a.instance;i.push(Promise.resolve().then(()=>l.validate(t,{skipFormValidation:!0}))),a.instance.state.meta.isTouched||a.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(t,i,r)=>{const a=this.getFieldValue(t),l=Array.isArray(a)?Math.max(a.length-1,0):null,u=[`${t}[${i}]`];for(let o=i+1;o<=(l??0);o++)u.push(`${t}[${o}]`);const d=Object.keys(this.fieldInfo).filter(o=>u.some(f=>o.startsWith(f))),h=[];return k(()=>{d.forEach(o=>{h.push(Promise.resolve().then(()=>this.validateField(o,r)))})}),(await Promise.all(h)).flat()},this.validateField=(t,i)=>{var a;const r=(a=this.fieldInfo[t])==null?void 0:a.instance;return r?(r.state.meta.isTouched||r.setMeta(l=>({...l,isTouched:!0})),r.validate(i)):[]},this.validateSync=t=>{const i=tt(t,{...this.options,form:this,validationLogic:this.options.validationLogic||_});let r=!1;const a={};return k(()=>{var d,h,c;for(const o of i){if(!o.validate)continue;const f=this.runValidator({validate:o.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:m,fieldErrors:M}=x(f),v=$(o.cause);for(const g of Object.keys(this.state.fieldMeta)){const y=this.getFieldMeta(g);if(!y)continue;const{errorMap:b,errorSourceMap:V}=y,F=M==null?void 0:M[g],{newErrorValue:p,newSource:E}=ut({newFormValidatorError:F,isPreviousErrorFromFormValidator:(V==null?void 0:V[v])==="form",previousErrorValue:b==null?void 0:b[v]});E==="form"&&(a[g]={...a[g],[v]:F}),(b==null?void 0:b[v])!==p&&this.setFieldMeta(g,L=>({...L,errorMap:{...L.errorMap,[v]:p},errorSourceMap:{...L.errorSourceMap,[v]:E}}))}((d=this.state.errorMap)==null?void 0:d[v])!==m&&this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[v]:m}})),(m||M)&&(r=!0)}const l=$("submit");(h=this.state.errorMap)!=null&&h[l]&&t!=="submit"&&!r&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[l]:void 0}}));const u=$("server");(c=this.state.errorMap)!=null&&c[u]&&t!=="server"&&!r&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[u]:void 0}}))}),{hasErrored:r,fieldsErrorMap:a}},this.validateAsync=async t=>{const i=et(t,{...this.options,form:this,validationLogic:this.options.validationLogic||_});this.state.isFormValidating||this.baseStore.setState(d=>({...d,isFormValidating:!0}));const r=[];let a;for(const d of i){if(!d.validate)continue;const h=$(d.cause),c=this.state.validationMetaMap[h];c==null||c.lastAbortController.abort();const o=new AbortController;this.state.validationMetaMap[h]={lastAbortController:o},r.push(new Promise(async f=>{let m;try{m=await new Promise((y,b)=>{setTimeout(async()=>{if(o.signal.aborted)return y(void 0);try{y(await this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:o.signal},type:"validateAsync"}))}catch(V){b(V)}},d.debounceMs)})}catch(y){m=y}const{formError:M,fieldErrors:v}=x(m);v&&(a=a?{...a,...v}:v);const g=$(d.cause);for(const y of Object.keys(this.state.fieldMeta)){const b=this.getFieldMeta(y);if(!b)continue;const{errorMap:V,errorSourceMap:F}=b,p=a==null?void 0:a[y],{newErrorValue:E,newSource:L}=ut({newFormValidatorError:p,isPreviousErrorFromFormValidator:(F==null?void 0:F[g])==="form",previousErrorValue:V==null?void 0:V[g]});(V==null?void 0:V[g])!==E&&this.setFieldMeta(y,A=>({...A,errorMap:{...A.errorMap,[g]:E},errorSourceMap:{...A.errorSourceMap,[g]:L}}))}this.baseStore.setState(y=>({...y,errorMap:{...y.errorMap,[g]:M}})),f(a?{fieldErrors:a,errorMapKey:g}:void 0)}))}let l=[];const u={};if(r.length){l=await Promise.all(r);for(const d of l)if(d!=null&&d.fieldErrors){const{errorMapKey:h}=d;for(const[c,o]of Object.entries(d.fieldErrors)){const m={...u[c]||{},[h]:o};u[c]=m}}}return this.baseStore.setState(d=>({...d,isFormValidating:!1})),u},this.validate=t=>{const{hasErrored:i,fieldsErrorMap:r}=this.validateSync(t);return i&&!this.options.asyncAlways?r:this.validateAsync(t)},this.getFieldValue=t=>R(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>{var i;return(i=this.fieldInfo)[t]||(i[t]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}})},this.setFieldMeta=(t,i)=>{this.baseStore.setState(r=>({...r,fieldMetaBase:{...r.fieldMetaBase,[t]:G(i,r.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((i,r)=>{const a=r;return i[a]=q,i},{}),this.setFieldValue=(t,i,r)=>{var d;const a=(r==null?void 0:r.dontUpdateMeta)??!1,l=(r==null?void 0:r.dontRunListeners)??!1,u=(r==null?void 0:r.dontValidate)??!1;k(()=>{a||this.setFieldMeta(t,h=>({...h,isTouched:!0,isDirty:!0,errorMap:{...h==null?void 0:h.errorMap,onMount:void 0}})),this.baseStore.setState(h=>({...h,values:U(h.values,t,i)}))}),l||(d=this.getFieldInfo(t).instance)==null||d.triggerOnChangeListener(),u||this.validateField(t,"change")},this.deleteField=t=>{const r=[...Object.keys(this.fieldInfo).filter(a=>{const l=t.toString();return a!==l&&a.startsWith(l)}),t];this.baseStore.setState(a=>{const l={...a};return r.forEach(u=>{l.values=At(l.values,u),delete this.fieldInfo[u],delete l.fieldMetaBase[u]}),l})},this.pushFieldValue=(t,i,r)=>{this.setFieldValue(t,a=>[...Array.isArray(a)?a:[],i],r)},this.insertFieldValue=async(t,i,r,a)=>{this.setFieldValue(t,l=>[...l.slice(0,i),r,...l.slice(i)],I(a,{dontValidate:!0})),await this.validateField(t,"change"),K(this).handleArrayFieldMetaShift(t,i,"insert"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.replaceFieldValue=async(t,i,r,a)=>{this.setFieldValue(t,l=>l.map((u,d)=>d===i?r:u),I(a,{dontValidate:!0})),await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.removeFieldValue=async(t,i,r)=>{const a=this.getFieldValue(t),l=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(t,u=>u.filter((d,h)=>h!==i),I(r,{dontValidate:!0})),K(this).handleArrayFieldMetaShift(t,i,"remove"),l!==null){const u=`${t}[${l}]`;this.deleteField(u)}await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.swapFieldValues=(t,i,r,a)=>{this.setFieldValue(t,l=>{const u=l[i],d=l[r];return U(U(l,`${i}`,d),`${r}`,u)},I(a,{dontValidate:!0})),K(this).handleArrayFieldMetaShift(t,i,"swap",r),this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${r}]`,"change")},this.moveFieldValues=(t,i,r,a)=>{this.setFieldValue(t,l=>{const u=[...l];return u.splice(r,0,u.splice(i,1)[0]),u},I(a,{dontValidate:!0})),K(this).handleArrayFieldMetaShift(t,i,"move",r),this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${r}]`,"change")},this.clearFieldValues=(t,i)=>{const r=this.getFieldValue(t),a=Array.isArray(r)?Math.max(r.length-1,0):null;if(this.setFieldValue(t,[],I(i,{dontValidate:!0})),a!==null)for(let l=0;l<=a;l++){const u=`${t}[${l}]`;this.deleteField(u)}this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[t]:q},values:this.options.defaultValues?U(i.values,t,R(this.options.defaultValues,t)):i.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[i,r])=>(Object.keys(r).length&&r.errors.length&&(t[i]={errors:r.errors,errorMap:r.errorMap}),t),{})}),this.parseValuesWithSchema=t=>B.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>B.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=(s==null?void 0:s.formId)??Ft(),this._devtoolsSubmissionOverride=!1,this.baseStore=new Mt(X({...s==null?void 0:s.defaultState,values:(s==null?void 0:s.defaultValues)??((n=s==null?void 0:s.defaultState)==null?void 0:n.values)})),this.fieldMetaDerived=new Y({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:i,prevVal:r})=>{var c,o,f;const a=r,l=t==null?void 0:t[0],u=i[0];let d=0;const h={};for(const m of Object.keys(u.fieldMetaBase)){const M=u.fieldMetaBase[m],v=l==null?void 0:l.fieldMetaBase[m],g=a==null?void 0:a[m],y=R(u.values,m);let b=g==null?void 0:g.errors;if(!v||M.errorMap!==v.errorMap){b=Object.values(M.errorMap??{}).filter(L=>L!==void 0);const E=(c=this.getFieldInfo(m))==null?void 0:c.instance;E&&!E.options.disableErrorFlat&&(b=b==null?void 0:b.flat(1))}const V=!Ot(b??[]),F=!M.isDirty,p=C(y,R(this.options.defaultValues,m))||C(y,(f=(o=this.getFieldInfo(m))==null?void 0:o.instance)==null?void 0:f.options.defaultValue);if(g&&g.isPristine===F&&g.isValid===V&&g.isDefaultValue===p&&g.errors===b&&M===v){h[m]=g,d++;continue}h[m]={...M,errors:b,isPristine:F,isValid:V,isDefaultValue:p}}return Object.keys(u.fieldMetaBase).length&&a&&d===Object.keys(u.fieldMetaBase).length?a:h}}),this.store=new Y({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:i,prevVal:r})=>{var rt,at,nt,ot;const a=r,l=t==null?void 0:t[0],u=i[0],d=i[1],h=Object.values(d).filter(Boolean),c=h.some(S=>S.isValidating),o=h.every(S=>S.isValid),f=h.some(S=>S.isTouched),m=h.some(S=>S.isBlurred),M=h.every(S=>S.isDefaultValue),v=f&&((rt=u.errorMap)==null?void 0:rt.onMount),g=h.some(S=>S.isDirty),y=!g,b=!!((at=u.errorMap)!=null&&at.onMount||h.some(S=>{var D;return(D=S==null?void 0:S.errorMap)==null?void 0:D.onMount})),V=!!c;let F=(a==null?void 0:a.errors)??[];(!l||u.errorMap!==l.errorMap)&&(F=Object.values(u.errorMap).reduce((S,D)=>D===void 0?S:D&&it(D)?(S.push(D.form),S):(S.push(D),S),[]));const p=F.length===0,E=o&&p,L=this.options.canSubmitWhenInvalid??!1,A=u.submissionAttempts===0&&!f&&!b||!V&&!u.isSubmitting&&E||L;let T=u.errorMap;if(v&&(F=F.filter(S=>S!==u.errorMap.onMount),T=Object.assign(T,{onMount:void 0})),a&&l&&a.errorMap===T&&a.fieldMeta===this.fieldMetaDerived.state&&a.errors===F&&a.isFieldsValidating===c&&a.isFieldsValid===o&&a.isFormValid===p&&a.isValid===E&&a.canSubmit===A&&a.isTouched===f&&a.isBlurred===m&&a.isPristine===y&&a.isDefaultValue===M&&a.isDirty===g&&C(l,u))return a;let P={...u,errorMap:T,fieldMeta:this.fieldMetaDerived.state,errors:F,isFieldsValidating:c,isFieldsValid:o,isFormValid:p,isValid:E,canSubmit:A,isTouched:f,isBlurred:m,isPristine:y,isDefaultValue:M,isDirty:g};const J=((nt=this.options.transform)==null?void 0:nt.deps)??[];if(J.length!==this.prevTransformArray.length||J.some((S,D)=>S!==this.prevTransformArray[D])){const S=Object.assign({},this,{state:P});(ot=this.options.transform)==null||ot.fn(S),P=S.state,this.prevTransformArray=J}return P}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(s||{}),this.store.subscribe(()=>{O.emit("form-state-change",{id:this._formId,state:this.store.state,options:this.options})}),O.on("request-form-state",t=>{t.payload.id===this._formId&&O.emit("form-state-change",{id:this._formId,state:this.store.state,options:this.options})}),O.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),O.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}formId(){return this._formId}runValidator(s){return mt(s.validate)?B[s.type](s.value,s.validate):s.validate(s.value)}async handleSubmit(s){var i,r,a,l,u,d,h,c;if(this.baseStore.setState(o=>({...o,isSubmitted:!1,submissionAttempts:o.submissionAttempts+1,isSubmitSuccessful:!1})),k(()=>{Object.values(this.fieldInfo).forEach(o=>{o.instance&&(o.instance.state.meta.isTouched||o.instance.setMeta(f=>({...f,isTouched:!0})))})}),!this.state.canSubmit&&!this._devtoolsSubmissionOverride)return;const n=s??this.options.onSubmitMeta;this.baseStore.setState(o=>({...o,isSubmitting:!0}));const t=()=>{this.baseStore.setState(o=>({...o,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){t(),(r=(i=this.options).onSubmitInvalid)==null||r.call(i,{value:this.state.values,formApi:this,meta:n}),O.emit("form-submission-state-change",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(o=>o.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){t(),(l=(a=this.options).onSubmitInvalid)==null||l.call(a,{value:this.state.values,formApi:this,meta:n}),O.emit("form-submission-state-change",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}k(()=>{Object.values(this.fieldInfo).forEach(o=>{var f,m,M;(M=(m=(f=o.instance)==null?void 0:f.options.listeners)==null?void 0:m.onSubmit)==null||M.call(m,{value:o.instance.state.value,fieldApi:o.instance})})}),(d=(u=this.options.listeners)==null?void 0:u.onSubmit)==null||d.call(u,{formApi:this,meta:n});try{await((c=(h=this.options).onSubmit)==null?void 0:c.call(h,{value:this.state.values,formApi:this,meta:n})),k(()=>{this.baseStore.setState(o=>({...o,isSubmitted:!0,isSubmitSuccessful:!0})),O.emit("form-submission-state-change",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),t()})}catch(o){throw this.baseStore.setState(f=>({...f,isSubmitSuccessful:!1})),O.emit("form-submission-state-change",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:o}),t(),o}}setErrorMap(s){k(()=>{Object.entries(s).forEach(([n,t])=>{const i=n;if(it(t)){const{formError:r,fieldErrors:a}=x(t);for(const l of Object.keys(this.fieldInfo))this.getFieldMeta(l)&&this.setFieldMeta(l,d=>({...d,errorMap:{...d.errorMap,[i]:a==null?void 0:a[l]},errorSourceMap:{...d.errorSourceMap,[i]:"form"}}));this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[i]:r}}))}else this.baseStore.setState(r=>({...r,errorMap:{...r.errorMap,[i]:t}}))})})}}function x(e){if(e){if(it(e)){const s=x(e.form).formError,n=e.fields;return{formError:s,fieldErrors:n}}return{formError:e}}return{formError:void 0}}function $(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Bt{constructor(s){this.options={},this.mount=()=>{var r,a;const n=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const l=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});l&&this.setMeta(u=>({...u,errorMap:{...u==null?void 0:u.errorMap,onMount:l},errorSourceMap:{...u==null?void 0:u.errorSourceMap,onMount:"field"}}))}return(a=(r=this.options.listeners)==null?void 0:r.onMount)==null||a.call(r,{value:this.state.value,fieldApi:this}),n},this.update=n=>{this.options=n;const t=this.name!==n.name;if(this.name=n.name,this.state.value===void 0){const i=R(n.form.options.defaultValues,n.name),r=n.defaultValue??i;t?this.setValue(a=>a||r,{dontUpdateMeta:!0}):r!==void 0&&this.setValue(r,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(n,t)=>{this.form.setFieldValue(this.name,n,I(t,{dontRunListeners:!0,dontValidate:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener(),t!=null&&t.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=n=>this.form.setFieldMeta(this.name,n),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(n,t)=>{this.form.pushFieldValue(this.name,n,I(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(n,t,i)=>{this.form.insertFieldValue(this.name,n,t,I(i,{dontRunListeners:!0})),i!=null&&i.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(n,t,i)=>{this.form.replaceFieldValue(this.name,n,t,I(i,{dontRunListeners:!0})),i!=null&&i.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(n,t)=>{this.form.removeFieldValue(this.name,n,I(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(n,t,i)=>{this.form.swapFieldValues(this.name,n,t,I(i,{dontRunListeners:!0})),i!=null&&i.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(n,t,i)=>{this.form.moveFieldValues(this.name,n,t,I(i,{dontRunListeners:!0})),i!=null&&i.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=n=>{this.form.clearFieldValues(this.name,I(n,{dontRunListeners:!0})),n!=null&&n.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=n=>{const t=Object.values(this.form.fieldInfo),i=[];for(const r of t){if(!r.instance)continue;const{onChangeListenTo:a,onBlurListenTo:l}=r.instance.options.validators||{};n==="change"&&(a!=null&&a.includes(this.name))&&i.push(r.instance),n==="blur"&&(l!=null&&l.includes(this.name))&&i.push(r.instance)}return i},this.validateSync=(n,t)=>{var d;const i=tt(n,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||_}),a=this.getLinkedFields(n).reduce((h,c)=>{const o=tt(n,{...c.options,form:c.form,validationLogic:c.form.options.validationLogic||_});return o.forEach(f=>{f.field=c}),h.concat(o)},[]);let l=!1;k(()=>{const h=(c,o)=>{var y;const f=z(o.cause),m=o.validate?ht(c.runValidator({validate:o.validate,value:{value:c.store.state.value,validationSource:"field",fieldApi:c},type:"validate"})):void 0,M=t[f],{newErrorValue:v,newSource:g}=dt({formLevelError:M,fieldLevelError:m});((y=c.state.meta.errorMap)==null?void 0:y[f])!==v&&c.setMeta(b=>({...b,errorMap:{...b.errorMap,[f]:v},errorSourceMap:{...b.errorSourceMap,[f]:g}})),v&&(l=!0)};for(const c of i)h(this,c);for(const c of a)c.validate&&h(c.field,c)});const u=z("submit");return(d=this.state.meta.errorMap)!=null&&d[u]&&n!=="submit"&&!l&&this.setMeta(h=>({...h,errorMap:{...h.errorMap,[u]:void 0},errorSourceMap:{...h.errorSourceMap,[u]:void 0}})),{hasErrored:l}},this.validateAsync=async(n,t)=>{const i=et(n,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||_}),r=await t,a=this.getLinkedFields(n),l=a.reduce((o,f)=>{const m=et(n,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||_});return m.forEach(M=>{M.field=f}),o.concat(m)},[]);this.state.meta.isValidating||this.setMeta(o=>({...o,isValidating:!0}));for(const o of a)o.setMeta(f=>({...f,isValidating:!0}));const u=[],d=[],h=(o,f,m)=>{const M=z(f.cause),v=o.getInfo().validationMetaMap[M];v==null||v.lastAbortController.abort();const g=new AbortController;this.getInfo().validationMetaMap[M]={lastAbortController:g},m.push(new Promise(async y=>{var L;let b;try{b=await new Promise((A,T)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(g.signal.aborted)return A(void 0);try{A(await this.runValidator({validate:f.validate,value:{value:o.store.state.value,fieldApi:o,signal:g.signal,validationSource:"field"},type:"validateAsync"}))}catch(P){T(P)}},f.debounceMs)})}catch(A){b=A}if(g.signal.aborted)return y(void 0);const V=ht(b),F=(L=r[this.name])==null?void 0:L[M],{newErrorValue:p,newSource:E}=dt({formLevelError:F,fieldLevelError:V});o.setMeta(A=>({...A,errorMap:{...A==null?void 0:A.errorMap,[M]:p},errorSourceMap:{...A.errorSourceMap,[M]:E}})),y(p)}))};for(const o of i)o.validate&&h(this,o,u);for(const o of l)o.validate&&h(o.field,o,d);let c=[];(u.length||d.length)&&(c=await Promise.all(u),await Promise.all(d)),this.setMeta(o=>({...o,isValidating:!1}));for(const o of a)o.setMeta(f=>({...f,isValidating:!1}));return c.filter(Boolean)},this.validate=(n,t)=>{var l;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=t!=null&&t.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(n),{hasErrored:r}=this.validateSync(n,i[this.name]??{});if(r&&!this.options.asyncAlways)return(l=this.getInfo().validationMetaMap[z(n)])==null||l.lastAbortController.abort(),this.state.meta.errors;const a=t!=null&&t.skipFormValidation?Promise.resolve({}):this.form.validateAsync(n);return this.validateAsync(n,a)},this.handleChange=n=>{this.setValue(n)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=n=>B.validate({value:this.state.value,validationSource:"field"},n),this.parseValueWithSchemaAsync=n=>B.validateAsync({value:this.state.value,validationSource:"field"},n),this.form=s.form,this.name=s.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new Y({deps:[this.form.store],fn:()=>{const n=this.form.getFieldValue(this.name),t=this.form.getFieldMeta(this.name)??{...q,...s.defaultMeta};return{value:n,meta:t}}}),this.options=s}get state(){return this.store.state}runValidator(s){return mt(s.validate)?B[s.type](s.value,s.validate):s.validate(s.value)}setErrorMap(s){this.setMeta(n=>({...n,errorMap:{...n.errorMap,...s}}))}triggerOnBlurListener(){var t,i,r,a,l,u;const s=(t=this.form.options.listeners)==null?void 0:t.onBlurDebounceMs;s&&s>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,h;(h=(d=this.form.options.listeners)==null?void 0:d.onBlur)==null||h.call(d,{formApi:this.form,fieldApi:this})},s)):(r=(i=this.form.options.listeners)==null?void 0:i.onBlur)==null||r.call(i,{formApi:this.form,fieldApi:this});const n=(a=this.options.listeners)==null?void 0:a.onBlurDebounceMs;n&&n>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var d,h;(h=(d=this.options.listeners)==null?void 0:d.onBlur)==null||h.call(d,{value:this.state.value,fieldApi:this})},n)):(u=(l=this.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var t,i,r,a,l,u;const s=(t=this.form.options.listeners)==null?void 0:t.onChangeDebounceMs;s&&s>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var d,h;(h=(d=this.form.options.listeners)==null?void 0:d.onChange)==null||h.call(d,{formApi:this.form,fieldApi:this})},s)):(r=(i=this.form.options.listeners)==null?void 0:i.onChange)==null||r.call(i,{formApi:this.form,fieldApi:this});const n=(a=this.options.listeners)==null?void 0:a.onChangeDebounceMs;n&&n>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var d,h;(h=(d=this.options.listeners)==null?void 0:d.onChange)==null||h.call(d,{value:this.state.value,fieldApi:this})},n)):(u=(l=this.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{value:this.state.value,fieldApi:this})}}function ht(e){if(e)return e}function z(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}const H=typeof window<"u"?j.useLayoutEffect:j.useEffect;function Pt(e){const[s]=j.useState(()=>{const t=new Bt({...e,form:e.form,name:e.name});return t.Field=vt,t});return H(s.mount,[s]),H(()=>{s.update(e)}),ft(s.store,e.mode==="array"?n=>[n.meta,Object.keys(n.value??[]).length]:void 0),s}const vt=(({children:e,...s})=>{const n=Pt(s),t=j.useMemo(()=>G(e,n),[e,n,n.state.value,n.state.meta]);return N.jsx(N.Fragment,{children:t})});function $t({form:e,selector:s,children:n}){const t=ft(e.store,s);return G(n,t)}function Ut(e){const[s]=j.useState(()=>{const n=new _t(e),t=n;return t.Field=function(r){return N.jsx(vt,{...r,form:n})},t.Subscribe=function(r){return N.jsx($t,{form:n,selector:r.selector,children:r.children})},t});return H(s.mount,[]),H(()=>{s.update(e)}),s}export{Ut as u};
